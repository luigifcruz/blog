<!doctype html><html lang=en><head><title>Making an Arduino Based Levitron :: Luigi Cruz — Computer Engineering Student. Radio Amateur (PU2SPY). Interested in Rockets, Satellites and Machine Learning.</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Me and my college group made this machine for Physics Class, so I decided to show how we made it here. The final machine can levitate a magnet smoothly for days!
  What the hell is Levitron? In short, Levitron is an electromagnet controlled by a micro-controller that “levitates” a permanent rare-earth magnet by alternating the coil current. If done quickly, it creates an illusion of levitation.
How it works?"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://test2.luigi.ltd/2016-12-12/making-an-arduino-based-levitron/><link rel=stylesheet href=https://test2.luigi.ltd/assets/style.css><link rel=stylesheet href=https://test2.luigi.ltd/assets/pink.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://test2.luigi.ltd/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://test2.luigi.ltd/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/luigifcruz"><meta name=twitter:creator content="luigifcruz"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Making an Arduino Based Levitron :: Luigi Cruz"><meta property="og:description" content="Me and my college group made this machine for Physics Class, so I decided to show how we made it here. The final machine can levitate a magnet smoothly for days!
  What the hell is Levitron? In short, Levitron is an electromagnet controlled by a micro-controller that “levitates” a permanent rare-earth magnet by alternating the coil current. If done quickly, it creates an illusion of levitation.
How it works?"><meta property="og:url" content="https://test2.luigi.ltd/2016-12-12/making-an-arduino-based-levitron/"><meta property="og:site_name" content="Making an Arduino Based Levitron"><meta property="og:image" content="https://test2.luigi.ltd/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2016-12-12 00:00:00 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Luigi Cruz</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/projects>Projects</a></li><li><a href=/talks>Talks</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/projects>Projects</a></li><li><a href=/talks>Talks</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://test2.luigi.ltd/2016-12-12/making-an-arduino-based-levitron/>Making an Arduino Based Levitron</a></h1><div class=post-meta><span class=post-date>2016-12-12</span>
<span class=post-author>::
Luigi Cruz</span></div><div class=post-content><div><p>Me and my college group made this machine for Physics Class, so I decided to show how we made it here. The final machine can levitate a magnet smoothly for days!</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/ivDXVJCK-wQ style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h3 id=what-the-hell-is-levitron>What the hell is Levitron?<a href=#what-the-hell-is-levitron class=hanchor arialabel=Anchor>&#8983;</a></h3><p>In short, Levitron is an electromagnet controlled by a micro-controller that “levitates” a permanent <a href=https://en.wikipedia.org/wiki/Rare-earth_magnet>rare-earth magnet</a> by alternating the coil current. If done quickly, it creates an illusion of levitation.</p><h3 id=how-it-works>How it works?<a href=#how-it-works class=hanchor arialabel=Anchor>&#8983;</a></h3><p>This Levitron uses a <a href=https://en.wikipedia.org/wiki/Hall_effect_sensor>Hall Effect Linear Sensor</a> to measure the magnetic field of the magnet by creating a voltage differential that is read by the Arduino. If the voltage is getting too high, this means that the magnet is getting closer to the coil, so the Arduino decrease the coil current. This makes the magnet fall with the gravity, and restart the cycle.</p><h2 id=first-step-the-electromagnet>First Step: The Electromagnet<a href=#first-step-the-electromagnet class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This is the main part of the project. The <a href=https://en.wikipedia.org/wiki/Electromagnet>Electromagnet</a> will generate the force we will need to pull the magnet in our direction. We used almost ~150 meters of 0.4 mm Copper Wire to make ~2000 turns in ~18 layers. This electromagnet is very strong, perhaps stronger than we need, so we will limit the max current to 1A@5V to prevent over-heating. In this case we <a href=https://twitter.com/luigifcruz/status/796422583457611786>3D printed</a> the reel.</p><p><img src=images/levitron-reel-being-printed.jpeg alt="Reel being printed."></p><p>Winding the coil will be the most tedious part of this project, but in the end you will have a very cool electromagnet! Thankfully Mateus made this for us with a screwdriver. Will be a good ideia to protect each layer with insulating tape to prevent any overlap. And remember to wind the wire always in the same direction.</p><p><img src=images/levitron-coil-being-winded.jpeg alt="Electromagnet being winded. (Source: Mateus Trindade)"></p><p>For the <a href=https://en.wikipedia.org/wiki/Electromagnet#Magnetic_core>Ferromagnetic Core</a>, we used a screw, but ideally it should fit perfectly inside the coil frame inner gap to generate the strongest magnetic field possible.</p><h2 id=second-part-linear-hall-effect-sensor>Second Part: Linear Hall Effect Sensor<a href=#second-part-linear-hall-effect-sensor class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This is the second more important part of the entire project. This sensor provides the only information the Arduino needs to tune the frequency of the <a href=https://en.wikipedia.org/wiki/Pulse-width_modulation>PWM</a> Signal for a steady levitation. This sensor relies on a magical electromagnetic effect called <a href=https://en.wikipedia.org/wiki/Hall_effect>Hall Effect</a>, which translates the magnetic field strength to a differential electrical potential, which can be easily read by the Arduino analog port. In this project we used the <a href=https://dscl.lcsr.jhu.edu/mainimages/3/31/SS49e_Hall_Sensor_Datasheet.pdf>SS49E Sensor</a>, but any linear hall sensor will get the job done. Notice that some sensors have a <a href=https://en.wikipedia.org/wiki/Schmitt_trigger>Schmitt Trigger</a> which translates the linear signal to PWM signal, making the sensor useless.</p><p><img src=images/levitron-coil-with-hall-sensor.jpeg alt="Dielectric separation between the bolt and the sensor."></p><p>We made a 1CM dielectric separation between the sensor and the bolt with hot glue to prevent interference with the magnetic field created by the coil. This minor change will make the interference of the coil magnetic field insignificant, so that it can be safely ignored.</p><h2 id=third-part-the-circuit>Third Part: The Circuit<a href=#third-part-the-circuit class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This is the most complex part of this project, below you can see the circuit diagram. The Arduino is wired with the Hall Effect Sensor thought a resistor. And the inductor have a flyback protection Diode (1N4148) to prevent the current generated by the magnetic field in the inductor fries everything. There is also an power LED indicator and N-Channel Transistor (IRF540) to handle the high current to the coil.</p><figure class=left><img src=images/levitron-schematic-arduino.png><figcaption class=center>Circuit Schematic (Source: MUCK Solutions)</figcaption></figure><h2 id=fourth-part-the-code>Fourth Part: The Code<a href=#fourth-part-the-code class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The code for this project is straightforward, you just need to say to the Arduino the equilibrium point of the magnet relative to the sensor readings. This is the only tuning you will need to do in this code.</p><p>After various tests we decided that a <a href=https://en.wikipedia.org/wiki/PID_controller>PID</a> filter wouldn’t be necessary. Yeah, PID would make the levitation more smooth over time, but also would add unnecessary complexity and processing time in each loop. We also added a Software <a href=https://en.wikipedia.org/wiki/Low-pass_filter>Low-pass Filter</a> for give us more smooth reading from the Sensor.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#define sensorPin A0 </span><span style=color:#75715e>// Hall Effect Sensor Pin
</span><span style=color:#75715e></span><span style=color:#75715e>#define pwmPin 3 </span><span style=color:#75715e>// Transisor Pin
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> levitPoint <span style=color:#f92672>=</span> <span style=color:#ae81ff>690</span>; <span style=color:#75715e>// Levitation Point relative to the sensor readings
</span><span style=color:#75715e></span>
<span style=color:#75715e>#define FILTER_SHIFT 4
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> sensorValue <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
<span style=color:#66d9ef>int</span> deltaLevit <span style=color:#f92672>=</span> <span style=color:#ae81ff>15</span>;
<span style=color:#66d9ef>int</span> maxL, minL;
<span style=color:#66d9ef>int</span> filter_input;
<span style=color:#66d9ef>int</span> filter_output;
<span style=color:#66d9ef>long</span> filter_reg;
byte induction <span style=color:#f92672>=</span> <span style=color:#ae81ff>128</span>;

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setup</span>() {
  pinMode(pwmPin, OUTPUT);

  <span style=color:#75715e>// PWM Direct Controller (Note Below)
</span><span style=color:#75715e></span>  TCCR2A <span style=color:#f92672>=</span> _BV(COM2A1) <span style=color:#f92672>|</span> _BV(COM2B1) <span style=color:#f92672>|</span> _BV(WGM20);
  TCCR2B <span style=color:#f92672>=</span> _BV(CS20);

  maxL <span style=color:#f92672>=</span> levitPoint <span style=color:#f92672>-</span> deltaLevit;
  minL <span style=color:#f92672>=</span> levitPoint <span style=color:#f92672>+</span> deltaLevit;
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loop</span>() {
  filter_input <span style=color:#f92672>=</span> analogRead(sensorPin);

  <span style=color:#75715e>// Lowpass Filter from http://www.edn.com/
</span><span style=color:#75715e></span>  filter_reg <span style=color:#f92672>=</span> filter_reg <span style=color:#f92672>-</span> (filter_reg <span style=color:#f92672>&gt;&gt;</span> FILTER_SHIFT) <span style=color:#f92672>+</span> filter_input;
  sensorValue <span style=color:#f92672>=</span> filter_reg <span style=color:#f92672>&gt;&gt;</span> FILTER_SHIFT;

  <span style=color:#66d9ef>if</span> (sensorValue <span style=color:#f92672>&lt;</span> levitPoint <span style=color:#f92672>-</span> <span style=color:#ae81ff>50</span>) {
    induction <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#66d9ef>if</span> (sensorValue <span style=color:#f92672>&gt;</span> maxL) induction <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>if</span> (sensorValue <span style=color:#f92672>&lt;</span> minL) induction <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
    <span style=color:#66d9ef>if</span> (sensorValue <span style=color:#f92672>&lt;=</span> maxL and sensorValue <span style=color:#f92672>&gt;=</span> minL) induction <span style=color:#f92672>=</span> ((sensorValue <span style=color:#f92672>-</span> maxL)<span style=color:#f92672>/</span><span style=color:#ae81ff>5</span>);
  }

  OCR2B <span style=color:#f92672>=</span> induction;
}
</code></pre></div><p><strong>Note</strong>: This piece of code give us direct (and faster) access to the hardware PWM pin of the ATmega, this tiny hack is well documented here.</p><h2 id=final-part-the-frame>Final Part: The Frame<a href=#final-part-the-frame class=hanchor arialabel=Anchor>&#8983;</a></h2><p>In this part you can do whatever you want, we made a wood frame to secure the coil in place, but it can be made out of any material, acrylic for example.</p><p><img src=images/levitron-frame-simulation.jpeg alt="Fusion 360 Load Simulation."></p><h2 id=appendix-next-up>Appendix: Next Up<a href=#appendix-next-up class=hanchor arialabel=Anchor>&#8983;</a></h2><p>In the near future I will add a serial feedback to MATLAB for educational purposes. Would be great to have a realtime plot to see how the magnetic field and PWM signal varies as the magnet moves and levitates.</p><p><img src=images/finished-levitron.jpeg alt="Finished Levitron"></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://test2.luigi.ltd/2017-01-30/quadrifilar-antenna-for-noaa-apt-satellites/><span class=button__icon>←</span>
<span class=button__text>Quadrifilar Antenna for NOAA APT Satellites</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://test2.luigi.ltd/assets/main.js></script><script src=https://test2.luigi.ltd/assets/prism.js></script></div></body></html>